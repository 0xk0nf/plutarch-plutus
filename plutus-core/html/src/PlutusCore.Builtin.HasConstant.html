<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds   #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies      #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Builtin.HasConstant</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#KnownTypeError"><span class="hs-identifier">KnownTypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#throwNotAConstant"><span class="hs-identifier">throwNotAConstant</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier">HasConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstantIn"><span class="hs-identifier">HasConstantIn</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.html"><span class="hs-identifier">PlutusCore.Core</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html"><span class="hs-identifier">PlutusCore.Evaluation.Machine.Exception</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Universe.html"><span class="hs-identifier">Universe</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- | Ensures that @term@ has a 'Constant'-like constructor to lift values to and unlift values from.</span><span>
</span><span id="line-19"></span><span class="hs-keyword">class</span><span> </span><span id="HasConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-var">HasConstant</span></a></span></span><span> </span><span id="local-6989586621681037854"><span class="annot"><a href="#local-6989586621681037854"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-comment">-- Switching from 'MonadError' to 'Either' here gave us a speedup of 2-4%.</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-comment">-- | Unlift from the 'Constant' constructor throwing an 'UnliftingError' if the provided @term@</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-comment">-- is not a 'Constant'.</span><span>
</span><span id="line-23"></span><span>    </span><span id="asConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#asConstant"><span class="hs-identifier hs-type">asConstant</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681037854"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#KnownTypeError"><span class="hs-identifier hs-type">KnownTypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/12m626qdhg61qnq44614xjh4avrzhzw4-some-lib-some-1.0.3-haddock-doc/share/doc/some/html/src"><span class="hs-identifier hs-type">Some</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037854"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-comment">-- | Wrap a Haskell value as a @term@.</span><span>
</span><span id="line-26"></span><span>    </span><span id="fromConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#fromConstant"><span class="hs-identifier hs-type">fromConstant</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/12m626qdhg61qnq44614xjh4avrzhzw4-some-lib-some-1.0.3-haddock-doc/share/doc/some/html/src"><span class="hs-identifier hs-type">Some</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037854"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681037854"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">-- | Ensures that @term@ has a 'Constant'-like constructor to lift values to and unlift values from</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- and connects @term@ and its @uni@.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="HasConstantIn"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstantIn"><span class="hs-identifier hs-var">HasConstantIn</span></a></span></span><span> </span><span id="local-6989586621681037835"><span class="annot"><a href="#local-6989586621681037835"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681037834"><span class="annot"><a href="#local-6989586621681037834"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037834"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037835"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-type">HasConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037834"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681037852"><span id="local-6989586621681037853"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-type">HasConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037853"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681037852"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>    </span><span id="local-6989586621681037825"><span class="annot"><span class="annottext">asConstant :: Term TyName Name uni fun ()
-&gt; Either
     KnownTypeError
     (Some (ValueOf (UniOf (Term TyName Name uni fun ()))))
</span><a href="#local-6989586621681037825"><span class="hs-identifier hs-var hs-var hs-var hs-var">asConstant</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681037823"><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621681037823"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni) -&gt; Either KnownTypeError (Some (ValueOf uni))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/r4n325d4bya4i1cviz6zrwmhm4j55yz4-ghc-9.2.3-doc/share/doc/ghc/html/libraries/base-4.16.2.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621681037823"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#asConstant"><span class="hs-identifier hs-var">asConstant</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ()
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either
  KnownTypeError
  (Some (ValueOf (UniOf (Term TyName Name uni fun ()))))
forall (m :: * -&gt; *) void. MonadError KnownTypeError m =&gt; m void
</span><a href="PlutusCore.Evaluation.Machine.Exception.html#throwNotAConstant"><span class="hs-identifier hs-var">throwNotAConstant</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621681037822"><span class="annot"><span class="annottext">fromConstant :: Some (ValueOf (UniOf (Term TyName Name uni fun ())))
-&gt; Term TyName Name uni fun ()
</span><a href="#local-6989586621681037822"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromConstant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Some (ValueOf uni) -&gt; Term TyName Name uni fun ()
forall tyname name (uni :: * -&gt; *) fun ann.
ann -&gt; Some (ValueOf uni) -&gt; Term tyname name uni fun ann
</span><a href="PlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span></pre></body></html>